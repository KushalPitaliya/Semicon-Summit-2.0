import React, { useState, useRef, useEffect } from 'react';
import { Link } from 'react-router-dom';
import Navbar from '../components/Navbar';
import Footer from '../components/Footer';
import ParticleField from '../components/ParticleField';
import {
    Cpu, Code, Trophy, Zap, Users, Lightbulb, Target, Award,
    ArrowRight, X, Calendar, Clock, MapPin, IndianRupee, ExternalLink, Eye,
    Sparkles, FileText, Mic2, Gamepad2, GraduationCap, Layers, Brain,
    Filter, CircuitBoard
} from 'lucide-react';
import './Events.css';

const CATEGORIES = [
    {
        id: 'all',
        title: 'All Events',
        icon: Sparkles,
        color: '#22c55e'
    },
    {
        id: 'industry-strategy',
        title: 'Industry & Strategy',
        description: 'High-impact discussions and expert insights.',
        color: '#10b981',
        icon: Mic2
    },
    {
        id: 'workshops',
        title: 'Technical Workshops',
        description: 'Hands-on exposure to VLSI flows.',
        color: '#14b8a6',
        icon: Code
    },
    {
        id: 'innovation',
        title: 'Competitions',
        description: 'Challenges to test your skills.',
        color: '#f59e0b',
        icon: Trophy
    },
    {
        id: 'industry-experience',
        title: 'Industry Info',
        description: 'Real-world demonstrations.',
        color: '#84cc16',
        icon: Zap
    }
];

const EVENTS = [
    // ── Category 1: Industry & Strategy ──
    {
        id: 'fabless-startups',
        categoryId: 'industry-strategy',
        title: 'Fabless Startups & MSMEs',
        subtitle: 'Powering India’s Semiconductor Growth',
        type: 'Industry Panel',
        icon: Users,
        poster: '/images/panel discussion event.png',
        prize: 'Networking',
        description: 'A strategic panel discussion featuring industry leaders and startup founders exploring the role of fabless companies and MSMEs in strengthening India’s semiconductor ecosystem.',
        fullDescription: `A strategic panel discussion featuring industry leaders and startup founders exploring the role of fabless companies and MSMEs in strengthening India’s semiconductor ecosystem.

This session will address:
• Growth of fabless semiconductor startups in India
• Opportunities and challenges in the MSME ecosystem
• Policy support and industry collaborations
• Talent requirements and future demand
• Building a sustainable semiconductor value chain

Participants will gain insights directly from industry experts shaping the next phase of India’s semiconductor development.`,
        date: 'March 17, 2026',
        time: '11:30 AM - 12:30 PM',
        venue: 'Main Auditorium',
        fee: 'Included',
        rulesUrl: null
    },
    {
        id: 'ai-vlsi',
        categoryId: 'industry-strategy',
        title: 'AI in VLSI',
        subtitle: 'Will It Change the VLSI Engineer?',
        type: 'Expert Insight',
        icon: Brain,
        poster: '/images/Al in VLSI.png',
        prize: 'Knowledge',
        description: 'Artificial Intelligence is reshaping semiconductor design workflows. This session examines how AI-driven EDA tools are redefining the role of VLSI engineers.',
        fullDescription: `Artificial Intelligence is reshaping semiconductor design workflows. This session examines how AI-driven EDA tools, automation in physical design, and intelligent verification systems are redefining the role of VLSI engineers.

Participants will gain clarity on evolving skill requirements and future industry expectations.

A must-attend discussion for students preparing for careers in chip design and automation-driven environments.`,
        date: 'March 19, 2026',
        time: '11:00 AM - 12:00 PM',
        venue: 'Seminar Hall A',
        fee: 'Included',
        rulesUrl: null
    },
    {
        id: 'embedded-vlsi',
        categoryId: 'industry-strategy',
        title: 'Embedded vs VLSI',
        subtitle: 'What Should I Choose?',
        type: 'Career Guidance',
        icon: GraduationCap,
        poster: '/images/expert-1.png',
        prize: 'Career Path',
        description: 'An interactive session designed to help students understand the differences between embedded systems and VLSI domains.',
        fullDescription: `An interactive session designed to help students understand the differences between embedded systems and VLSI domains.

Key discussion points include:
• Core skill requirements
• Industry demand and growth trends
• Learning pathways
• Career progression opportunities

This session aims to provide clarity for students at early academic stages.`,
        date: 'March 18, 2026',
        time: '09:45 AM - 11:00 AM',
        venue: 'Seminar Hall B',
        fee: 'Included',
        rulesUrl: null
    },

    // ── Category 2: Workshops ──
    {
        id: 'rtl-gds',
        categoryId: 'workshops',
        title: 'RTL to GDS II',
        subtitle: 'Open Source ASIC Design Flow',
        type: 'Advanced Workshop',
        icon: Layers,
        poster: '/images/Hands on workshop-2.png',
        prize: 'Certificates',
        description: 'Explore the complete open-source ASIC design flow — from RTL design to GDS II generation. For final-year students and advanced learners.',
        fullDescription: `This advanced, hands-on workshop is designed for final-year students and participants with prior knowledge of digital design and HDL concepts.

Participants will explore the complete open-source ASIC design flow — from RTL design to GDS II generation.

Workshop Coverage:
• RTL design concepts
• Synthesis using open-source tools
• Static timing considerations
• Floorplanning & placement basics
• Routing and layout generation
• Understanding GDS II output

Recommended For: Final-year students.`,
        date: 'March 18, 2026',
        time: 'Full Day (Starts 9 AM)',
        venue: 'Lab Complex 1',
        fee: 'Included',
        rulesUrl: null
    },
    {
        id: 'verilog-fpga',
        categoryId: 'workshops',
        title: 'Verilog & FPGA',
        subtitle: 'Getting Started with Digital Design',
        type: 'Beginner Workshop',
        icon: CircuitBoard,
        poster: '/images/Hands on Workshop.png',
        prize: 'Certificates',
        description: 'Beginner-friendly workshop covering Verilog programming and basic FPGA-based system development for 1st and 2nd year students.',
        fullDescription: `This beginner-friendly workshop is designed for 1st and 2nd year students who want to build a strong foundation in digital hardware design and FPGA implementation.

Participants will be introduced to Verilog programming and basic FPGA-based system development.

Workshop Coverage:
• Introduction to digital design concepts
• Basics of Verilog HDL
• Writing simple modules
• Simulation fundamentals
• Introduction to FPGA boards
• Running and testing simple hardware designs

Recommended For: 1st and 2nd year students.`,
        date: 'March 18, 2026',
        time: 'Full Day (Starts 9 AM)',
        venue: 'Lab Complex 2',
        fee: 'Included',
        rulesUrl: null
    },

    // ── Category 3: Innovation & Competitions ──
    {
        id: 'shark-tank',
        categoryId: 'innovation',
        title: 'Silicon Shark Tank',
        subtitle: 'Industry-Driven Idea Pitching',
        type: 'Flagship Event',
        icon: Lightbulb,
        poster: '/images/Silicon Shark Tank.png',
        prize: 'Internships',
        description: 'A flagship innovation challenge connecting student ideas with industry evaluation and internship pathways. Two-round competitive platform.',
        fullDescription: `Silicon Shark Tank is a two-round competitive platform designed to encourage innovation in semiconductor technology.

Round 1 – Screening Round (Idea Submission)
Submit a technical concept proposal (max 500 words) covering:
• Problem Statement
• Proposed Solution
• Technical Domain (VLSI-focused)

Round 2 – Live Pitch to the Sharks
Shortlisted teams will present their ideas before an industry panel.
• Total Time: 10 minutes per team
• Format: Slides, architecture, block diagrams

Rewards: Winning team members will receive internship opportunities from leading semiconductor startups.`,
        date: 'March 19, 2026',
        time: '09:00 AM - 01:00 PM',
        venue: 'Main Auditorium',
        fee: 'Prize Pool',
        rulesUrl: '/images/SHARK TANK Rules.docx'
    },
    {
        id: 'silicon-jackpot',
        categoryId: 'innovation',
        title: 'The Silicon Jackpot',
        subtitle: 'Technical Treasure Hunt',
        type: 'Competition',
        icon: Target,
        poster: '/images/The Silicon Jackpot.png',
        prize: '₹15,000 Pool',
        description: 'A structured three-round challenge combining technical quizzes, applied problem-solving, and a live FPGA-based grand finale.',
        fullDescription: `The Silicon Jackpot is a structured three-round challenge combining technical knowledge with practical problem-solving skills.

Round Structure:
• Round 1: Technical Quiz Sprint — MCQ quiz on semi fundamentals
• Round 2: Problem-Solving Challenge — Applied design thinking
• Round 3: Live FPGA Battle — Grand finale with hands-on challenge

Each round tests a different aspect of technical ability.`,
        date: 'March 19, 2026',
        time: '02:00 PM - 05:00 PM',
        venue: 'Campus Grounds',
        fee: 'Prize Pool',
        rulesUrl: null
    },
    {
        id: 'playzone',
        categoryId: 'innovation',
        title: 'Silicon PlayZone',
        subtitle: 'Technical Game Arena',
        type: 'Interactive',
        icon: Gamepad2,
        poster: '/images/MAIN.png',
        prize: 'Merchandise',
        description: 'Hands-On. Minds-On. A dynamic zone designed to make engineering interactive and engaging.',
        fullDescription: `A dynamic zone designed to make engineering interactive and engaging.

Activities include:
• Spin the Wheel — Technical surprise challenges
• Truth or Dare — Electronics edition
• Join the Circuit — Rapid connection logic challenge
• Mini hardware-based problem-solving tasks`,
        date: 'All Days',
        time: 'Open All Day',
        venue: 'Expo Area',
        fee: 'Included',
        rulesUrl: null
    },
    {
        id: 'ideas-showcase',
        categoryId: 'innovation',
        title: 'Silicon Ideas Showcase',
        subtitle: 'Silent Feedback Edition',
        type: 'Exhibition',
        icon: Eye,
        poster: '/images/Silent Silicon Gallery.png',
        prize: 'Best Idea',
        description: 'Walk Through Innovation. Leave Your Insight. Silent poster exhibition with QR-based digital feedback system.',
        fullDescription: `Silent Silicon — Innovation Gallery Walk

Students present semiconductor and hardware innovation ideas through poster exhibits. Instead of traditional verbal presentations, participants receive structured written feedback from visitors via sticky notes and digital interaction.

Each poster includes a QR code enabling attendees to:
• Access detailed technical explanations
• Submit questions digitally
• Provide structured feedback`,
        date: 'All Days',
        time: 'Open All Day',
        venue: 'Corridor A',
        fee: 'Included',
        rulesUrl: null
    },

    // ── Category 4: Industry Experience ──
    {
        id: 'wafer-chip',
        categoryId: 'industry-experience',
        title: 'Wafer to Chip',
        subtitle: 'Live Demonstration by Monk9',
        type: 'Industry Demo',
        icon: Cpu,
        poster: '/images/Stall Visit.png',
        prize: 'Learning',
        description: 'See How a Chip Comes to Life — From Silicon Wafer to Working Chip. An industry-led demonstration by Monk9.',
        fullDescription: `Wafer to Chip — Live Demonstration by Monk9

An industry-led demonstration offering a complete view of the semiconductor lifecycle — from wafer fabrication concepts to final chip realization.

Conducted by industry experts from Monk9, this session provides participants with real-world insights into:
• Semiconductor fabrication fundamentals
• Chip design and verification workflow
• Industry toolchains and development stages`,
        date: 'March 19, 2026',
        time: 'Late Morning',
        venue: 'Stall Area',
        fee: 'Included',
        rulesUrl: null
    }
];

/* ─── EVENT MODAL (2-Column) ─── */
const EventModal = ({ event, onClose }) => {
    if (!event) return null;

    useEffect(() => {
        document.body.style.overflow = 'hidden';
        return () => { document.body.style.overflow = ''; };
    }, []);

    const handleViewRules = (e) => {
        e.stopPropagation();
        if (event.rulesUrl) window.open(event.rulesUrl, '_blank');
    };

    const category = CATEGORIES.find(c => c.id === event.categoryId);
    const catColor = category?.color || '#22c55e';

    return (
        <div className="ev-modal-overlay" onClick={onClose}>
            <div className="ev-modal-container-2col" onClick={e => e.stopPropagation()}>
                <button className="ev-modal-close-btn" onClick={onClose} aria-label="Close modal">
                    <X size={24} />
                </button>

                {/* Left Column: Poster */}
                <div className="ev-modal-left">
                    <img src={event.poster || 'https://placehold.co/600x800/102030/22c55e?text=No+Poster'} alt={event.title} className="ev-modal-poster-img" />
                    <div className="ev-modal-poster-overlay-grad" />
                </div>

                {/* Right Column: Details */}
                <div className="ev-modal-right">
                    <div className="ev-modal-header-section">
                        <span className="ev-modal-badge" style={{ borderColor: catColor, color: catColor }}>{event.type}</span>
                        <h2 className="ev-modal-title">{event.title}</h2>
                        <h3 className="ev-modal-subtitle" style={{ color: catColor }}>{event.subtitle}</h3>
                    </div>

                    <div className="ev-modal-info-grid">
                        <div className="ev-modal-info-box">
                            <Calendar size={18} className="ev-icon" />
                            <div>
                                <span className="ev-label">Date</span>
                                <span className="ev-value">{event.date}</span>
                            </div>
                        </div>
                        <div className="ev-modal-info-box">
                            <Clock size={18} className="ev-icon" />
                            <div>
                                <span className="ev-label">Time</span>
                                <span className="ev-value">{event.time}</span>
                            </div>
                        </div>
                        <div className="ev-modal-info-box">
                            <MapPin size={18} className="ev-icon" />
                            <div>
                                <span className="ev-label">Venue</span>
                                <span className="ev-value">{event.venue}</span>
                            </div>
                        </div>
                        <div className="ev-modal-info-box">
                            <IndianRupee size={18} className="ev-icon" />
                            <div>
                                <span className="ev-label">Fee</span>
                                <span className="ev-value">{event.fee}</span>
                            </div>
                        </div>
                    </div>

                    <div className="ev-modal-desc">
                        <h4>Description</h4>
                        <div className="ev-desc-text">
                            {event.fullDescription.split('\n').map((line, i) => (
                                <p key={i}>{line}</p>
                            ))}
                        </div>
                    </div>

                    <div className="ev-modal-actions">
                        {event.rulesUrl && (
                            <button className="ev-btn-outline" onClick={handleViewRules}>
                                <FileText size={18} /> Event Rules
                            </button>
                        )}
                        <Link to="/register" className="ev-btn-primary">
                            Register Now <ExternalLink size={18} />
                        </Link>
                    </div>
                </div>
            </div>
        </div>
    );
};

/* ─── EVENT CARD (Restructured) ─── */
const EventCard = ({ event, category, index, onClick }) => {
    return (
        <div
            className="ev-card-modern"
            onClick={onClick}
            style={{ '--delay': `${index * 0.1}s` }}
        >
            <div className="ev-card-modern-poster-wrap">
                <img src={event.poster || 'https://placehold.co/400x400/102030/22c55e?text=No+Poster'} alt={event.title} loading="lazy" />
                <div className="ev-card-overlay-grad" />
                <span className="ev-card-badge">{event.type}</span>
            </div>

            <div className="ev-card-modern-content">
                <div className="ev-card-info-bar">
                    <span className="ev-card-fee-badge">
                        {event.fee === 'Included' ? 'Included' : event.fee}
                    </span>
                    <span className="ev-card-rules-text">
                        {event.rulesUrl ? 'Rules Available' : ''}
                    </span>
                </div>

                <div className="ev-card-buttons">
                    <button className="ev-btn-view">
                        View Details
                    </button>
                    <Link to="/register" className="ev-btn-reg" onClick={(e) => e.stopPropagation()}>
                        Register <ArrowRight size={14} />
                    </Link>
                </div>
            </div>
        </div>
    );
};

/* ─── EVENTS PAGE ─── */
const Events = () => {
    const [selectedEvent, setSelectedEvent] = useState(null);
    const [activeCategory, setActiveCategory] = useState('all');

    const filteredEvents = activeCategory === 'all'
        ? EVENTS
        : EVENTS.filter(e => e.categoryId === activeCategory);

    return (
        <div className="events-page-new">
            <Navbar />

            <section className="events-hero-mini">
                <ParticleField count={30} />
                <div className="events-hero-wrap">
                    <h1>Explore <span className="text-gradient">Events</span></h1>
                    <p>Workshops, Competitions & Panels</p>
                </div>
            </section>

            {/* Filter Bar */}
            <div className="events-filter-bar-sticky">
                <div className="events-filter-container">
                    {CATEGORIES.map(cat => (
                        <button
                            key={cat.id}
                            className={`filter-tab ${activeCategory === cat.id ? 'active' : ''}`}
                            onClick={() => setActiveCategory(cat.id)}
                        >
                            <cat.icon size={16} />
                            <span>{cat.title}</span>
                        </button>
                    ))}
                </div>
            </div>

            <div className="events-main-container">
                <div className="events-grid-modern">
                    {filteredEvents.map((event, index) => {
                        const cat = CATEGORIES.find(c => c.id === event.categoryId);
                        return (
                            <EventCard
                                key={event.id}
                                event={event}
                                category={cat}
                                index={index}
                                onClick={() => setSelectedEvent(event)}
                            />
                        );
                    })}
                </div>
            </div>

            {selectedEvent && (
                <EventModal
                    event={selectedEvent}
                    onClose={() => setSelectedEvent(null)}
                />
            )}

            <Footer />
        </div>
    );
};

export default Events;
